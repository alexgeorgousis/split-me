<div
  id="receipt_item_<%= receipt_item.id %>"
  class="border rounded-md overflow-hidden transition-all hover:shadow-md <%= receipt_item.undecided? ? "border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-800" : "border-blue-400 dark:border-blue-600 bg-blue-50 dark:bg-blue-900/20" %> relative">

  <%= button_to split_receipt_item_path(receipt_item.receipt.split, receipt_item),
    method: :patch,
    params: { split_mode: receipt_item.undecided? ? 'mine' : 'undecided' },
    form_class: "w-full",
    class: "w-full text-left p-4 cursor-pointer",
    onclick: "if (window.getSelection().toString()) { event.preventDefault(); return false; }" do %>
    <div class="flex justify-between items-start pr-24">
      <div class="flex items-start space-x-3">
        <div class="flex-1">
          <h3 class="font-medium text-lg select-text"><%= receipt_item.name %></h3>
          <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">
            <span class="select-text">Price: £<%= sprintf("%.2f", receipt_item.price) %></span>
          </div>
        </div>
      </div>
    </div>
  <% end %>

  <div class="absolute top-4 right-4 z-20 flex space-x-2">
    <%= button_to toggle_favourite_split_receipt_item_path(receipt_item.receipt.split, receipt_item),
      method: :post,
      form_class: "inline-block",
      class: "rounded-full border-2 border-pink-600 p-1 bg-white dark:bg-gray-800" do %>
      <%= icon receipt_item.favourite? ? "heart_filled" : "heart_unfilled", css_class: "w-6 h-6 text-pink-600 hover:text-pink-500 dark:text-pink-700 dark:hover:text-pink-600 cursor-pointer" %>
    <% end %>
    <%= button_to split_receipt_item_path(receipt_item.receipt.split, receipt_item),
      method: :delete,
      form: { data: { turbo_confirm: "Are you sure you want to delete this item?" } },
      form_class: "inline-block",
      class: "rounded-full border-2 border-red-600 p-1 bg-white dark:bg-gray-800" do %>
      <%= icon "bin", css_class: "w-6 h-6 text-red-600 hover:text-red-500 dark:text-red-700 dark:hover:text-red-600 cursor-pointer" %>
    <% end %>
  </div>

  <div class="border-t border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 px-4 py-3 <%= receipt_item.undecided? ? 'hidden' : 'block' %>" data-controller="assign-item-modal">
    <div class="flex items-center justify-between mb-2">
      <span
        class="text-xs text-gray-500 dark:text-gray-400">Your share: £<%= receipt_item.my_share %>
    </span>
    </div>

    <div class="flex flex-row justify-evenly">

      <%= button_to split_receipt_item_path(receipt_item.receipt.split, receipt_item),
        method: :patch,
        params: { split_mode: "mine" },
        class: "rounded-full border-2 p-2 transition-all cursor-pointer #{receipt_item.mine? ? 'border-green-400 bg-green-50 dark:bg-green-900/20' : 'border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 hover:border-green-600 hover:bg-green-50 dark:hover:bg-green-900/20'}" do %>
        <%= icon "hand_raised", css_class: "w-6 h-6 #{receipt_item.mine? ? 'text-green-600 dark:text-green-400' : 'text-gray-600 dark:text-gray-400'}" %>
      <% end %>

      <%= button_to split_receipt_item_path(receipt_item.receipt.split, receipt_item),
        method: :patch,
        params: { split_mode: "shared" },
        class: "rounded-full border-2 p-2 transition-all cursor-pointer relative overflow-hidden #{receipt_item.shared? ? 'border-green-400' : 'border-gray-300 dark:border-gray-600 hover:border-yellow-600 hover:bg-yellow-50 dark:hover:bg-yellow-900/20'}" do %>
        <%= icon "people", css_class: "w-6 h-6 relative z-10 #{receipt_item.shared? ? 'text-orange-600 dark:text-orange-400' : 'text-gray-600 dark:text-gray-400'}" %>
      <% end %>

      <button type="button"
        data-action="click->assign-item-modal#open"
        class="rounded-full border-2 p-2 transition-all cursor-pointer border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 hover:border-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20">
        <%= icon "user_plus", css_class: "w-6 h-6 text-gray-600 dark:text-gray-400" %>
      </button>

    </div>

    <div data-assign-item-modal-target="modal" class="hidden fixed inset-0 z-50 flex items-center justify-center">
      <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" data-action="click->assign-item-modal#close"></div>
      <div class="relative bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 max-w-md w-full mx-4">
        <h2 class="text-xl font-bold mb-4">Assign to someone</h2>
        <input type="text" placeholder="Enter person's name" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100">
        <div class="flex justify-end gap-2 mt-4">
          <button type="button" data-action="click->assign-item-modal#close" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg cursor-pointer">Cancel</button>
          <button type="button" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 cursor-pointer">Assign</button>
        </div>
      </div>
    </div>
  </div>
</div>
