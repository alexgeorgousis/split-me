<%= turbo_frame_tag "receipt_item_#{receipt_item.id}", data: { controller: "receipt-item" } do %>
  <%= button_to toggle_selection_order_receipt_item_path(order, receipt_item), method: :patch, class: "w-full text-left", data: { action: "click->receipt-item#toggle" } do %>
    <div class="border rounded-md p-4 cursor-pointer transition-all hover:shadow-md <%= receipt_item.selected? ? (receipt_item.ingredient_matches.any? ? 'border-green-400 bg-green-100' : 'border-blue-400 bg-blue-100') : 'border-gray-300 bg-gray-50' %>" data-price="<%= receipt_item.price %>" data-selected="<%= receipt_item.selected? %>">
      <div class="flex justify-between items-start">
        <div class="flex items-start space-x-3">
          <div class="mt-1">
            <% if receipt_item.selected? %>
              <div class="w-5 h-5 bg-blue-600 border-2 border-blue-600 rounded flex items-center justify-center">
                <svg class="w-3 h-3 text-white" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                </svg>
              </div>
            <% else %>
              <div class="w-5 h-5 border-2 border-gray-400 rounded"></div>
            <% end %>
          </div>
          <div class="flex-1">
            <h3 class="font-medium text-lg"><%= receipt_item.name %></h3>
            <div class="text-sm text-gray-600 mt-1">
              <span>Price: £<%= receipt_item.price %></span>
            </div>
          </div>
        </div>

        <div class="ml-4">
          <% if receipt_item.ingredient_matches.any? %>
            <div class="text-green-600 text-sm">
              <span class="font-medium">✓ Matched to:</span>
              <% receipt_item.ingredient_matches.each do |match| %>
                <div class="mt-1">
                  <span class="text-blue-600"><%= match.ingredient.name %></span>
                  <span class="text-gray-500">(confidence: <%= (match.confidence * 100).round(1) %>%)</span>
                </div>
              <% end %>
            </div>
          <% else %>
            <span class="text-orange-600 text-sm">⚠ No matches found</span>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>
<% end %>